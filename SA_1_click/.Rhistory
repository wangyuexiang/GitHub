temp1 <- inner_join(temp,t)
# ggplot(temp1) + geom_point(aes(Date, TimeSor))
g1 <- ggplot(temp1) + geom_point(aes(Date, TimeSor, col = as.factor(ord))) + theme(legend.position = "none")
g2 <- ggplot(temp1 %>% filter(ord < 3)) + geom_point(aes(Date, TimeSor, col = as.factor(ord)))
temp2 <- temp1 %>% filter(ord <3)
g3 <- ggplot(temp2) + geom_bar(aes(DOW, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g4 <- ggplot(temp2) + geom_bar(aes(TimeSor, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g5 <- ggplot(temp2) + geom_tile(aes(WOY,DOW, fill = as.factor(ord))) + facet_wrap(~ord, ncol = 1) + theme(legend.position = "none")
grid.arrange(g1,g2,g3,g4, g5, ncol = 2, main = title)
temp.OD
### Julien    49
temp <- BDD.temp %>% filter(N == 49)
temp.OD <- temp %>%
group_by(Entr, Sor) %>%
summarise(n = n()) %>%
ungroup() %>%
arrange(desc(n)) %>%
mutate(ord = row_number())
title <- temp$Nom[1]
t <- temp.OD %>% select(-n)
temp1 <- inner_join(temp,t)
# ggplot(temp1) + geom_point(aes(Date, TimeSor))
g1 <- ggplot(temp1) + geom_point(aes(Date, TimeSor, col = as.factor(ord))) + theme(legend.position = "none")
g2 <- ggplot(temp1 %>% filter(ord < 3)) + geom_point(aes(Date, TimeSor, col = as.factor(ord)))
temp2 <- temp1 %>% filter(ord <3)
g3 <- ggplot(temp2) + geom_bar(aes(DOW, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g4 <- ggplot(temp2) + geom_bar(aes(TimeSor, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g5 <- ggplot(temp2) + geom_tile(aes(WOY,DOW, fill = as.factor(ord))) + facet_wrap(~ord, ncol = 1) + theme(legend.position = "none")
grid.arrange(g1,g2,g3,g4, g5, ncol = 2, main = title)
temp.OD
### Julien    49
temp <- BDD.temp %>% filter(N == 46)
temp.OD <- temp %>%
group_by(Entr, Sor) %>%
summarise(n = n()) %>%
ungroup() %>%
arrange(desc(n)) %>%
mutate(ord = row_number())
title <- temp$Nom[1]
t <- temp.OD %>% select(-n)
temp1 <- inner_join(temp,t)
# ggplot(temp1) + geom_point(aes(Date, TimeSor))
g1 <- ggplot(temp1) + geom_point(aes(Date, TimeSor, col = as.factor(ord))) + theme(legend.position = "none")
g2 <- ggplot(temp1 %>% filter(ord < 3)) + geom_point(aes(Date, TimeSor, col = as.factor(ord)))
temp2 <- temp1 %>% filter(ord <3)
g3 <- ggplot(temp2) + geom_bar(aes(DOW, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g4 <- ggplot(temp2) + geom_bar(aes(TimeSor, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g5 <- ggplot(temp2) + geom_tile(aes(WOY,DOW, fill = as.factor(ord))) + facet_wrap(~ord, ncol = 1) + theme(legend.position = "none")
grid.arrange(g1,g2,g3,g4, g5, ncol = 2, main = title)
temp.OD
temp <- BDD.temp %>% filter(N == 45)
temp.OD <- temp %>%
group_by(Entr, Sor) %>%
summarise(n = n()) %>%
ungroup() %>%
arrange(desc(n)) %>%
mutate(ord = row_number())
title <- temp$Nom[1]
t <- temp.OD %>% select(-n)
temp1 <- inner_join(temp,t)
# ggplot(temp1) + geom_point(aes(Date, TimeSor))
g1 <- ggplot(temp1) + geom_point(aes(Date, TimeSor, col = as.factor(ord))) + theme(legend.position = "none")
g2 <- ggplot(temp1 %>% filter(ord < 3)) + geom_point(aes(Date, TimeSor, col = as.factor(ord)))
temp2 <- temp1 %>% filter(ord <3)
g3 <- ggplot(temp2) + geom_bar(aes(DOW, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g4 <- ggplot(temp2) + geom_bar(aes(TimeSor, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g5 <- ggplot(temp2) + geom_tile(aes(WOY,DOW, fill = as.factor(ord))) + facet_wrap(~ord, ncol = 1) + theme(legend.position = "none")
grid.arrange(g1,g2,g3,g4, g5, ncol = 2, main = title)
temp.OD
### James     48
### Julien    49
temp <- BDD.temp %>% filter(N == 44)
temp.OD <- temp %>%
group_by(Entr, Sor) %>%
summarise(n = n()) %>%
ungroup() %>%
arrange(desc(n)) %>%
mutate(ord = row_number())
title <- temp$Nom[1]
t <- temp.OD %>% select(-n)
temp1 <- inner_join(temp,t)
# ggplot(temp1) + geom_point(aes(Date, TimeSor))
g1 <- ggplot(temp1) + geom_point(aes(Date, TimeSor, col = as.factor(ord))) + theme(legend.position = "none")
g2 <- ggplot(temp1 %>% filter(ord < 3)) + geom_point(aes(Date, TimeSor, col = as.factor(ord)))
temp2 <- temp1 %>% filter(ord <3)
g3 <- ggplot(temp2) + geom_bar(aes(DOW, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g4 <- ggplot(temp2) + geom_bar(aes(TimeSor, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g5 <- ggplot(temp2) + geom_tile(aes(WOY,DOW, fill = as.factor(ord))) + facet_wrap(~ord, ncol = 1) + theme(legend.position = "none")
grid.arrange(g1,g2,g3,g4, g5, ncol = 2, main = title)
temp.OD
temp <- BDD.temp %>% filter(N == 42)
temp.OD <- temp %>%
group_by(Entr, Sor) %>%
summarise(n = n()) %>%
ungroup() %>%
arrange(desc(n)) %>%
mutate(ord = row_number())
title <- temp$Nom[1]
t <- temp.OD %>% select(-n)
temp1 <- inner_join(temp,t)
# ggplot(temp1) + geom_point(aes(Date, TimeSor))
g1 <- ggplot(temp1) + geom_point(aes(Date, TimeSor, col = as.factor(ord))) + theme(legend.position = "none")
g2 <- ggplot(temp1 %>% filter(ord < 3)) + geom_point(aes(Date, TimeSor, col = as.factor(ord)))
temp2 <- temp1 %>% filter(ord <3)
g3 <- ggplot(temp2) + geom_bar(aes(DOW, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g4 <- ggplot(temp2) + geom_bar(aes(TimeSor, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g5 <- ggplot(temp2) + geom_tile(aes(WOY,DOW, fill = as.factor(ord))) + facet_wrap(~ord, ncol = 1) + theme(legend.position = "none")
grid.arrange(g1,g2,g3,g4, g5, ncol = 2, main = title)
temp.OD
temp <- BDD.temp %>% filter(N == 47)
temp.OD <- temp %>%
group_by(Entr, Sor) %>%
summarise(n = n()) %>%
ungroup() %>%
arrange(desc(n)) %>%
mutate(ord = row_number())
title <- temp$Nom[1]
t <- temp.OD %>% select(-n)
temp.OD
t0
count(t0,Nom)
source('~/SVN/1-click_Dev/SA_end2end.R', echo=TRUE)
count(t0,Nom)
t0
source('~/SVN/1-click_Dev/SA_function.R', encoding = 'UTF-8', echo=TRUE)
source('~/SVN/1-click_Dev/SA_end2end.R', echo=TRUE)
source('~/SVN/1-click_Dev/SA_function.R', encoding = 'UTF-8', echo=TRUE)
source('~/SVN/1-click_Dev/SA_end2end.R', echo=TRUE)
result.final
save.image()
### call packages
library(dplyr)
library(cluster)
library(ggplot2)
library(zoo)
library(gridExtra)
library(knitr)
count(result.ID)
count(result,ID)
result
count(result,ID)
temp
BDD <- read.table("BDD.v20151001.csv", sep = ";", header = TRUE) %>% tbl_df
BDD <- BDD %>%
mutate(ID = as.character(ID),
Date = as.Date(as.character(Date)),
Nom = as.character(Nom)
)
ref <- read.table("Ref.ID.v20151001.csv", sep = ";", header = TRUE) %>% tbl_df
ref <- ref %>% mutate(ID = as.character(ID))
ref <- ref %>% mutate(N = row_number())
ref <- ref %>% filter(N !=43)
ref <- ref %>% mutate(N = row_number())
temp <- ref %>% select(ID, N)
BDD <- inner_join(BDD, temp)
BDD <- BDD %>% distinct
result <- read.table("result.v20151001.csv", sep = ";", header = TRUE) %>% tbl_df
result <- result %>% mutate(ID = as.character(ID), OD = as.character(OD))
result <- inner_join(result, temp)
result <- result %>% distinct
count(result,ID)
count(result,N)
result %>% filter(N == 1)
write.table(result, file="Result.v20151026.csv", sep = ";", row.names = F, quote = F)
t0
count(t0,Nom,N)
result.final
result.final %>% count(ID)
count(t0,Nom,N,ID)
result
result.final
ref
t <- ref %>% select(ID,Ste,EVA,Nom,N)
t1 <- left_join(result.final, t)
count(t1,ID)
result
t1
t %>% filter(ID == 982894610001)
t
ref
ref.temp
t1 <- left_join(result.final, ref.temp)
t1
t2 <- rbind(result,t1)
count(t2,Nom,N)
write.table(result, file="Result.v20151026.csv", sep = ";", row.names = F, quote = F)
write.table(t2, file="Result.v20151026.csv", sep = ";", row.names = F, quote = F)
write.table(t2, file="Result.v20151026.csv", sep = ";", row.names = F, quote = F)
count(t2,N)
ref <- ref.temp
ref
BDD %>% filter(N == 42)
BDD %>% filter(N == 44)
save.image()
t <- BDD %>% filter(N == 44)
count(t,Entr, Sor)
temp <- BDD.temp %>% filter(N == 44)
temp.OD <- temp %>%
group_by(Entr, Sor) %>%
summarise(n = n()) %>%
ungroup() %>%
arrange(desc(n)) %>%
mutate(ord = row_number())
title <- temp$Nom[1]
t <- temp.OD %>% select(-n)
temp1 <- inner_join(temp,t)
temp1
temp1 %>% filter(ord <2)
temp1 %>% filter(ord <3)
temp1 %>% filter(ord <3) %>% ggplot() + geom_point(aes(Date,TimeSor))
t <- temp1 %>% filter(ord <3)
count(t,Entr,Sor)
count(t,DOW)
t <- t %>% filter(DOW == 2)
t
ggplot(t) + geom_boxplot(aes(TimeSor))
ggplot(t) + geom_boxplot(aes(x= ord, y =TimeSor))
ggplot(t) + geom_boxplot(aes(x= ord, y =TimeSor))  + facet_wrap(~ord)
result
t1 <- t %>%
group_by(Ste, EVA, Nom, N, ID, Entr, Sor) %>%
summarise(Tmoy = mean(TimeSor),
SD = SD(TimeSor),
Tmin = Tmoy - SD,
Tmax = Tmoy + SD)
t1 <- t %>%
group_by(Ste, EVA, Nom, N, ID, Entr, Sor) %>%
summarise(Tmoy = mean(TimeSor),
SD = sd(TimeSor),
Tmin = Tmoy - SD,
Tmax = Tmoy + SD)
t1
result
count(result,N)
t2
count(t2,N)
result <- t2
t1 <- t %>%
group_by(Ste, EVA, Nom, N, ID, Entr, Sor) %>%
summarise(Tmoy = mean(TimeSor),
SD = sd(TimeSor),
Tmin = Tmoy - SD,
Tmax = Tmoy + SD,
noPsg = n())
t1
t2
sens
t2 <- sens %>% select(-Voie)
t1 <- inner_join(t1, t2)
t1
t3 <- t1 %>% mutate(OD = paste0(Entr,"-",Sor,"-",SensEntr,"-",SensSor,,"-"0))
t3 <- t1 %>% mutate(OD = paste0(Entr,"-",Sor,"-",SensEntr,"-",SensSor,"-",0))
t3
t3 <- t1 %>%
mutate(OD = paste0(Entr,"-",Sor,"-",SensEntr,"-",SensSor,"-",0)) %>%
select(Ste, EVA, Nom, N, ID, OD, Tmin, Tmax, noPsg)
t3
result
class(t1)
t3 <- t1 %>%
ungroup() %>%
mutate(OD = paste0(Entr,"-",Sor,"-",SensEntr,"-",SensSor,"-",0)) %>%
select(Ste, EVA, Nom, N, ID, OD, Tmin, Tmax, noPsg)
t3
result
result1 <- rbind(result,t3)
ncol(result)
ncol(t3)
t3$DOW <- 2
result1 <- rbind(result,t3)
result <- rbind(result,t3)
write.table(result, file="Result.v20151026.csv", sep = ";", row.names = F, quote = F)
count(result,Nom)
t <- read.table("BDD.ESCOTA.v20151029.csv", sep = ";", header = TRUE) %>% tbl_df
### call packages
library(dplyr)
library(cluster)
library(ggplot2)
library(zoo)
library(gridExtra)
library(knitr)
t <- read.table("BDD.ESCOTA.v20151029.csv", sep = ";", header = TRUE) %>% tbl_df
t
names(t) <- c("sSor", "cSor", "Voie", "DateSor", "hSor",
"ID", "porteur",
"sEntr", "cEntr", "DateEntr","hEntr",  "voieEntr")
t
t2 <- t %>%
mutate(
ID = ID * 1e5 + porteur,
Entr = 25000000 + sEntr * 1000 + cEntr,
Sor = 25000000 + sSor * 1000 + cSor,
Y = substr(DateSor, 1, 4), M = substr(DateSor, 5, 6), D = substr(DateSor, 7, 8),
Date = as.Date(paste0(Y, "-", M, "-", D)),
DOW = as.POSIXlt(Date)$wday,
WOY = as.numeric(format(Date+3, "%U")),
HH = hEntr %/% 10000, MM = ((hEntr %% 10000) %/% 100),
TimeEntr = HH + MM / 60,
HH = hSor %/% 10000, MM = ((hSor %% 10000) %/% 100),
TimeSor = HH + MM / 60
) %>%
select(ID, cEntr, Entr, Sor, Voie, Date, DOW, WOY, TimeEntr, TimeSor)
t2[t2$cEntr == 0, ]$Entr <- 0
t2[t2$cEntr != 0, ]$Voie <- 0
t2$cEntr <- NULL
t2
ref
BDD
t2
temp <- t2
temp
temp.OD <- temp %>%
group_by(Entr, Sor) %>%
summarise(n = n()) %>%
ungroup() %>%
arrange(desc(n)) %>%
mutate(ord = row_number())
# add ord
t1 <- temp.OD %>% select(-n)
temp1 <- inner_join(temp,t1)
# ggplot(temp1) + geom_point(aes(Date, TimeSor))
g1 <- ggplot(temp1) + geom_point(aes(Date, TimeSor, col = as.factor(ord))) + theme(legend.position = "none")
g2 <- ggplot(temp1 %>% filter(ord < 3)) + geom_point(aes(Date, TimeSor, col = as.factor(ord)))
temp2 <- temp1 %>% filter(ord <3)
g3 <- ggplot(temp2) + geom_bar(aes(DOW, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g4 <- ggplot(temp2) + geom_bar(aes(TimeSor, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g5 <- ggplot(temp2) + geom_tile(aes(WOY,DOW, fill = as.factor(ord))) + facet_wrap(~ord, ncol = 1) + theme(legend.position = "none")
# grid.arrange(g1,g2,g3,g4, g5, ncol = 2, main = paste0("ID = ", k))
temp.OD
print(grid.arrange(g1,g2,g3,g4, g5, ncol = 2, main = paste0("ID = ", k) ))
print(grid.arrange(g1,g2,g3,g4, g5, ncol = 2, main = paste0("ID = ") ))
t0 <- temp
t0
trx <- t0 %>% filter(Date >= train.start & Date < test.end)
trx <- trx %>% mutate(Voie = ifelse(Entr == 0, Voie, 0))
trx <- trx %>% left_join(sens)
trx <- trx %>% mutate(SensEntr = ifelse(is.na(SensEntr), 0, SensEntr),
SensSor = ifelse(is.na(SensSor), 0, SensSor))
trx
x
trx <- Sens(trx)
trx <- Sens(trx)
trx
trx <- SO(trx)
trx <- inverse.after.SO(trx)
trx <- trx %>% mutate(OD = paste0(Entr,"-",Sor,"-",SensEntr,"-",SensSor,"-",Sens))
train <- trx %>% filter(Date < test.start)
test <- trx %>% filter(Date >= test.start)
# get the ID list
ID.list <- trx %>% group_by(ID) %>% summarise()
# !!! get running time
end.time.preparation <- Sys.time()
########
#Find the number max of cluster by the density of TimeSor over 24h
# For each person
# NbClusterMax <- getNbClusterMax( train )
### ??? trx or train
models.units <- getModel.units( trx )
# train <- inverse.after.SO(train)
# test <- inverse.after.SO(test)
#Model 0 (decades) : BENCHMARK
result.model.decade.0 <- Model.for.a.decade(train,0,models.units)
# !!! get running time
end.time.model.0 <- Sys.time()
#Model 1 (decades)	Time-Space
result.model.decade.1 <- Model.for.a.decade(train,1,models.units)
#Model 2 (decades) OD -> Space -> Time
result.model.decade.2 <- Model.for.a.decade(train,2,models.units)
##########
# evaluation
##########
####################
####################
### evalutaion model.00
test.model.0 <- GetResult(test, result.model.decade.0)
test.model.0$ModelDecade <- 0
ind.model.0 <- GetInd(test.model.0, result.model.decade.0)
ind.model.0$ModelDecade <- 0
### evalutaion model.01
test.model.1 <- GetResult(test, result.model.decade.1)
test.model.1$ModelDecade <- 1
ind.model.1 <- GetInd(test.model.1, result.model.decade.1)
ind.model.1$ModelDecade <- 1
### evalutaion model.02
test.model.2 <- GetResult(test, result.model.decade.2)
test.model.2$ModelDecade <- 2
ind.model.2 <- GetInd(test.model.2, result.model.decade.2)
ind.model.2$ModelDecade <- 2
##########
# compare model results
##########
Ind <- rbind(ind.model.0, ind.model.1, ind.model.2)
Ind <- inner_join ( Ind, models.units)
Ind.final <- Ind %>%
group_by(ID) %>%
summarise( Model = ModelDecade[Ind == max(Ind)][1]*10 + model[Ind == max(Ind)][1])
result <- rbind(result.model.decade.0, result.model.decade.1, result.model.decade.2)
result.final <- inner_join(result, Ind.final)
# write.table(result.final, file="result.csv", sep = ";", row.names = F, quote = F)
Ind
Ind.final
result
result.final
result.final$Model <- NULL
result.final <- result.final %>%
arrange (ID, desc(noPsg), Tmin) %>%
filter(noPsg > 5)
result.final
ref
temp <- count(t2,ID)
temp
temp$Nom <- "Magali Mannarini"
temp$Ste <- 25006
temp$EVA <- 2424049
temp$N <- 50
temp
rbind(ref,temp)
temp$n <- NULL
rbind(ref,temp)
ref <- rbind(ref,temp)
ref
write.table(ref.temp, file="Ref.ID.v20151029.csv", sep = ";", row.names = F, quote = F)
count(BDD,ref)
count(BDD,ID)
count(BDD,Nom)
temp
t1 <- left_join(result.final, ref)
t1
count(t1,OD)
result
r <- read.table(file="Result.v20151026.csv", sep = ";", header = TRUE)
r
rbind(r,t1)
r
r %>% tbl_df
r <- read.table(file="Result.v20151026.csv", sep = ";", header = TRUE) %>% tbl_df
r
result.final
result <- rbind(r,t1)
result
write.table(result, file="Result.v20151029.csv", sep = ";", row.names = F, quote = F)
ref
ref$EVA[ref$N == 23]
ref$EVA[ref$N == 23] <- 2629771
ref$EVA[ref$N == 19] <- 2424144
ref$EVA[ref$N == 38] <- 598771
ref
write.table(ref, file="Ref.ID.v20151102.csv", sep = ";", row.names = F, quote = F)
ref
result
count(result,ID)
count(result,Nom)
library(dplyr)
library(cluster)
library(ggplot2)
library(zoo)
library(gridExtra)
library(knitr)
count(result,Nom)
result
result %>% filter(N == 23)
result %>% filter(N == 19)
result %>% filter(N == 38)
count(BDD,N)
count(BDD,ID)
count(BDD.temp,ID)
result$EVA[result$N == 23] <- 2629771
result$EVA[result$N == 19] <- 2424144
result$EVA[result$N == 38] <- 598771
result %>% filter(N == 38)
write.table(result, file="Result.v20151102.csv", sep = ";", row.names = F, quote = F)
library(dplyr)
library(ggplot2)
ref
ref %>% filter(N == 45)
BDD %>% filter(N == 45)
BDD
BDD %>% filter(N == 44)
BDD %>% filter(N == 46)
BDD %>% count(Nom)
BDD.temp
BDD.temp %>% count(Nom)
BDD.temp %>% count(Nom, N)
BDD.temp %>% filter( N == 44)
BDD.temp %>% filter( N == 45)
t <- BDD.temp %>% filter( N == 45)
temp <- t
temp.OD <- temp %>%
group_by(Entr, Sor) %>%
summarise(n = n()) %>%
ungroup() %>%
arrange(desc(n)) %>%
mutate(ord = row_number())
# add ord
t1 <- temp.OD %>% select(-n)
temp1 <- inner_join(temp,t1)
# ggplot(temp1) + geom_point(aes(Date, TimeSor))
g1 <- ggplot(temp1) + geom_point(aes(Date, TimeSor, col = as.factor(ord))) + theme(legend.position = "none")
g2 <- ggplot(temp1 %>% filter(ord < 3)) + geom_point(aes(Date, TimeSor, col = as.factor(ord)))
temp2 <- temp1 %>% filter(ord <3)
g3 <- ggplot(temp2) + geom_bar(aes(DOW, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g4 <- ggplot(temp2) + geom_bar(aes(TimeSor, fill = as.factor(ord)), binwidth = 1, position = "dodge") + theme(legend.position = "none")
g5 <- ggplot(temp2) + geom_tile(aes(WOY,DOW, fill = as.factor(ord))) + facet_wrap(~ord, ncol = 1) + theme(legend.position = "none")
# grid.arrange(g1,g2,g3,g4, g5, ncol = 2, main = paste0("ID = ", k))
grid.arrange(g1,g2,g3,g4, g5, ncol = 2, main = "Patricia Lanteri" )
library(ggplot2)
library(gridExtra)
grid.arrange(g1,g2,g3,g4, g5, ncol = 2, main = "Patricia Lanteri" )
temp.OD
gares %>% filter(Cde == 25006012)
gares %>% filter(Cde == 25006011)
BDD <- BDD.temp
