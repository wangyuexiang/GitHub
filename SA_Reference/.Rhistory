t2 <- ESCOTA.sens.SO %>% filter(gare == 10) %>% arrange(voie) %>% select(gare,voie,ES)
t2$Res <- TRUE
full_join(t1,t2)
rm(t1,t2)
rm(temp)
t1 <- ESCOTA.sens.SF %>%
select(Entr, Sor, SensEntr, SensSor) %>%
mutate(Voie = 0)
t2 <- ESCOTA.sens.SO %>%
transmute (Entr = 0, Sor = Cde, Voie = voie, SensEntr = 0, SensSor = Sens)
ESCOTA.sens <- rbind(t1,t2)
rm(t1,t2)
ESCOTA.sens
ESCOTA.sens %>% filter(Sor == 25006010)
ESCOTA.ref
sens
sens %>% filter(Entr == 0)
t1 <- ESCOTA.ref %>% transmute(Sor = 25006000 + gare, voie)
t2 <- sens %>% filter(Entr == 0)
t1
t2
t1$Ref <- TRUE
t2 <- sens %>% filter(Entr == 0)
t3 <- full_join(t1,t2)
t3
count(t3,Ref)
sum(is.na(t3))
t3 %>% filter(is.na(t3))
t3 %>% filter(is.na(t3$SensEntr))
t3 %>% filter(is.na(t3$SensEntr)) %>% group_by(Sor)
t3 %>% filter(is.na(t3$SensEntr)) %>% group_by(Sor) %>% summarise(n=n())
t1
t3
count(t3,Ref)
sum(is.na(t3))
sum(is.na(t2))
t2
ESCOTA.sens.SO
t4 <- ESCOTA.sens.SO %>% transmute(Sor = Cde, ES, voie, Sens)
t4$SO <- TRUE
t5 <- full_join(t1,t4)
class(t1$voie)
class(t2$voie)
t2
class(t2$Voie)
t1 <- ESCOTA.ref %>% transmute(Sor = 25006000 + gare, Voie = as.numeric(as.character(voie)))
t1$Ref <- TRUE
t2 <- sens %>% filter(Entr == 0)
t3 <- full_join(t1,t2)
sum(is.na(t3))
t3
sum(is.na(t4))
sum(is.na(t5))
t4$SO <- TRUE
t5 <- full_join(t1,t4)
t4
sum(is.na(t5))
count(t5,SO)
count(t5,Sens)
ESCOTA.ref
count(ESCOTA.ref,gare)
ESCOTA.ref <- read.table("Gares_ESCOTA_ref.csv", header = T, sep = ";") %>% tbl_df()
names(ESCOTA.ref)[2] <- "ES"
ESCOTA.ref <- read.table("Gares_ESCOTA_ref.csv", header = T, sep = ";") %>% tbl_df()
ESCOTA.ref
names(ESCOTA.ref)[2] <- "ES"
count(ESCOTA.ref,gare)
count(ESCOTA.ref,ES)
ESCOTA.ref <- ESCOTA.ref %>% filter(ES %in% c("E", "S"))
ESCOTA.ref <- ESCOTA.ref %>%
filter(ES %in% c("E", "S")) %>%
mutate(voie = as.numeric(as.character(voie)))
ESCOTA.ref
sum(is.na(ESCOTA.ref))
sum(is.na(ESCOTA.ref$voie))
ESCOTA.ref %>% filter(is.na(ESCOTA.ref$voie))
ESCOTA.ref <- read.table("Gares_ESCOTA_ref.csv", header = T, sep = ";") %>% tbl_df()
names(ESCOTA.ref)[2] <- "ES"
count(ESCOTA.ref,voie)
count(ESCOTA.ref,voie) %>% print(n = 78)
ESCOTA.ref %>% filter(voie == "N.E")
ESCOTA.ref
ESCOTA.ref <- ESCOTA.ref %>%
filter(ES %in% c("E", "S")) %>%
mutate(voie = as.numeric(as.character(voie))) %>%
filter(!is.na(voie))
sum(is.na(ESCOTA.ref))
count(ESCOTA.ref, type)
ESCOTA.ref <- read.table("Gares_ESCOTA_ref.csv", header = T, sep = ";") %>% tbl_df()
names(ESCOTA.ref)[2] <- "ES"
count(ESCOTA.ref,voie) %>% print(n = 78)
t <- ESCOTA.ref
count(t,voie)
t$V <- as.numeric(as.character(t$voie))
count(t,voie,V)
count(t,voie,V) %>% print(n=78
)
##########
ESCOTA.ref <- read.table("Gares_ESCOTA_ref.csv", header = T, sep = ";") %>% tbl_df()
names(ESCOTA.ref)[2] <- "ES"
ESCOTA.ref <- ESCOTA.ref %>%
filter(ES %in% c("E", "S")) %>%
mutate(voie = as.numeric(as.character(voie))) %>%
filter(!is.na(voie))
ESCOTA.temp <- ESCOTA.ref %>% distinct(gare, ES) %>% transmute(gare, ES, Cde = 25006000 + gare)
ESCOTA.SF <-  read.table("SF_2014.csv", header = T,  sep = ";", dec = ".") %>% tbl_df()
tSF.E <- ESCOTA.SF %>% distinct(Entr) %>% transmute(gare = Entr, Lib = Entree, ES = "E" , Cde = 25006000 + Entr)
tSF.S <- ESCOTA.SF %>% distinct(Sor) %>% transmute(gare = Sor, Lib = Sortie, ES = "S" , Cde = 25006000 + Sor)
tSF <- rbind(tSF.E, tSF.S)
# ggplot(tSF) + geom_bar(aes(gare, fill = as.factor(ES)), binwidth = 1)
tSF$Sys <- "F"
ESCOTA.SO <-  read.table("SO_2014.csv", header = T,  sep = ";", dec = ".") %>% tbl_df()
tSO <- ESCOTA.SO %>% transmute(gare = Cde, Lib, Cde = 25006000 + gare)
tSO$ES <- "O"
tSO$Sys <-"O"
tTarif <- rbind(tSF, tSO)
temp <- tTarif %>% distinct(gare) %>% select(gare, Lib, Cde, Sys)
ESCOTA.temp <- left_join(ESCOTA.temp, temp) # get Sys
ESCOTA.temp$es <- 1
ESCOTA.temp$es[ESCOTA.temp$ES == "S"] <- 10
ESCOTA.temp <- ESCOTA.temp %>% group_by(Cde, gare, Lib, Sys) %>% summarise(es = sum(es))
ESCOTA.temp$ES <- "ES"
ESCOTA.temp$ES[ESCOTA.temp$es == 1] <- "E"
ESCOTA.temp$ES[ESCOTA.temp$es == 10] <- "S"
rm(tSF, tSF.E, tSF.S, tSO, tTarif)
temp <- gares.LngLat %>% filter(Ste == 6) %>% select(Autoroute, Cde, PK, Lng, Lat)
ESCOTA.temp <- left_join(ESCOTA.temp, temp)
ESCOTA.temp <- ESCOTA.temp %>% ungroup() %>% select(-es)
ESCOTA <- ESCOTA.temp
rm(ESCOTA.temp)
ggplot(ESCOTA,aes(Lng, Lat)) + geom_point(aes(col = as.factor(Sys)), size = 3, alpha = .5) +
geom_text(aes(label = gare), hjust=1, vjust=0)
tSO <- ESCOTA.SO %>% transmute(gare = Cde, Lib)
tSO <- left_join(tSO, ESCOTA %>% select(Cde, gare, Autoroute))
t <- ESCOTA.ref %>%
select(gare, ES, voie)
class(t$voie)
tSO <- left_join(tSO, t)
# case 1:
# Canet de mereuil, Antibes ouest,  Saint Isidore Ech Ouest, La Turibe Ech Est
# Ceux dont les voies >= 20 sont en sens 1
t1 <- tSO %>%
filter(gare %in% c(1,14,19,26)) %>%
mutate(Sens = ifelse(voie >=20, 1, 2))
# case 2:
# FrÃ©jus, Les Adrets, Antibes PV, Antibes Est, Cagnes Est, Saint Isidore ech Est, Saint Isidore PV, La Turbie PV
# Ceux dont les voies >= 20 sont en sens 2
t2 <- tSO %>%
filter(gare %in% c(10,11,12,13,16,20,21,27)) %>%
mutate(Sens = ifelse(voie >=20, 2, 1))
# case 3:
# 17,24: Sens = 1
# 15: Sens = 2
t3 <- tSO%>%
filter(gare %in% c(15,17,24)) %>%
mutate(Sens = ifelse(gare == 15, 2, 1))
# case4:
# not in A8
t4 <- tSO%>%
filter(Autoroute != "A8") %>%
mutate(Sens = 0)
ESCOTA.sens.SO <- rbind(t1,t2,t3,t4)
rm(t,t1,t2,t3,t4, tSO)
t1 <- ESCOTA.sens.SF %>%
select(Entr, Sor, SensEntr, SensSor) %>%
mutate(Voie = 0)
t2 <- ESCOTA.sens.SO %>%
transmute (Entr = 0, Sor = Cde, Voie = voie, SensEntr = 0, SensSor = Sens)
ESCOTA.sens <- rbind(t1,t2)
rm(t1,t2)
sens <- rbind(ASF.sens, ESCOTA.sens)
t1 <- ESCOTA.ref %>% transmute(Sor = 25006000 + gare, Voie = voie)
t1$Ref <- TRUE
t2 <- sens %>% filter(Entr == 0)
t1
t2
t3 <- full_join(t1,t2)
sum(is.na(t3))
ESCOTA.ref
count(ESCOTA.ref,gare)
ESCOTA
t1
t <- ESCOTA %>% transmute(Sor = Cde, Sys)
t
t <- ESCOTA %>% transmute(Sor = Cde, Sys) %>% filter(Sys == "O")
inner_join(t1,t)
count(t1, Sor)
t1 <- inner_join(t1,t)
count(t1, Sor)
t1 <- ESCOTA.ref %>% transmute(Sor = 25006000 + gare, Voie = voie)
t1$Ref <- TRUE
t <- ESCOTA %>% transmute(Sor = Cde, Sys) %>% filter(Sys == "O")
t1 <- inner_join(t1,t)
t1
t3 <- full_join(t1,t2)
sum(is.na(t3))
save(sens, file="Sens_ref.RData")
write.table(sens,"Sens_ASF_ESCOTA.csv",sep=";",row.name=FALSE,quote=FALSE)
library(dplyr)
JF <- read.table("JF-2014-2015-2016.csv", header = T, sep = ";", dec = ",") %>% tbl_df()
JF
JF <- read.table("JF-2014-2015-2016.csv", header = TRUE, sep = ";", dec = ",") %>% tbl_df()
JF <- read.table("JF-2014-2015-2016.csv", header = TRUE, sep = ";") %>% tbl_df()
JF <- read.table("JF-2014-2015-2016.csv", header = TRUE, sep = ";")
JF <- read.table("JF-2014-2015-2016.csv", header = TRUE, sep = ",")
JF <- read.table("JF_2014-2015-2016.csv", header = TRUE, sep = ",") %>% tbl_df()
JF
count(JF,JF)
JF <- JF %>% filter(Year > 2014) %>% select(Date,DOW,WOY,JF)
JF
count(JF,JF)
library(ggplot2)
ggplot(JF) + geom_bar(aes(DOW), binwidth=1)
ggplot(JF) + geom_bar(aes(DOW), binwidth=1) + xlim(c(0,8))
ggplot(JF) + geom_bar(aes(DOW, fill = as.factor(JF)), binwidth=1) + xlim(c(0,8))
ggplot(JF) + geom_bar(aes(DOW, fill = as.factor(JF)), binwidth=1) + xlim(c(0,7))
save(JF, file="JF.RData")
JF <- read.table("JF_2014-2015-2016.csv", header = TRUE, sep = ",") %>% tbl_df()
JF <- JF %>% filter(Year > 2014)
ggplot(JF) + geom_bar(aes(WOY, fill = as.factor(JF)), binwidth=1) + xlim(c(0,7))
ggplot(JF) + geom_bar(aes(WOY, fill = as.factor(JF)), binwidth=1) + xlim(c(0,12))
ggplot(JF) + geom_bar(aes(WOY, fill = as.factor(JF)), binwidth=1) + xlim(c(0,52))
ggplot(JF) + geom_bar(aes(WOY, fill = as.factor(JF)), binwidth=1) + xlim(c(0,53))
JF
ggplot(JF) + geom_tile(aes(Date, DOW, fill = as.factor(JF)))
ggplot(JF) + geom_tile(aes(Year*100+WOY, DOW, fill = as.factor(JF)))
count(JF,JF,DOW)
count(JF,JF,DOW) %>% filter(JF == 1)
count(JF,JF,DOW %in% c(0,6)) %>% filter(JF == 1)
JF <- JF %>% select(Date,DOW, JF)
save(JF, file="JF.RData")
JF
library(dplyr)
library(rmarkdown)
library(ggplot2)
library(gridExtra)
sens %>% filter(Entr == 0, Sor > 25006000, Sor == 25006010)
class(JF$Date)
library(dplyr)
JF$Date <- as.Date(as.character(JF$Date))
class(JF$Date)
save(JF, file="JF.RData")
JF
sens
write.table(sens,"Ref.sens",sep=";",row.name=FALSE,quote=FALSE)
write.table(JF,"JF.sens",sep=";",row.name=FALSE,quote=FALSE)
write.table(sens,"Ref_sens.csv",sep=";",row.name=FALSE,quote=FALSE)
write.table(JF,"Ref_JF.csv",sep=";",row.name=FALSE,quote=FALSE)
library(dplyr)
library(rmarkdown)
library(ggplot2)
library(gridExtra)
garesq
gares
sens
gare
gares.LngLat
t1 <- sens %>% filter(Entr != 0)
t1 <- sens %>% filter(Entr != 0) %>% select(Entr, Sor)
t1 <- sens %>% filter(Entr != 0) %>% select(Entr, Sor)
t <- gares.LngLat %>% transmute(Entr = Cde, Elng = Lng, Elat = Lat)
t1 <- inner_join(t1,t)
t <- gares.LngLat %>% transmute(Sor = Cde, Slng = Lng, Slat = Lat)
t1 <- inner_join(t1,t)
t1
rm(ASF.sens, ESCOTA.sens)
rm(t1,t2, ESCOTA.sens.SF, ESCOTA.sens.SO)
rm(t3,t5)
rm(t,t3,t5,temp)
t1 <- sens %>% filter(Entr != 0) %>% select(Entr, Sor)
t <- gares.LngLat %>% transmute(Entr = Cde, Elng = Lng, Elat = Lat)
t1 <- inner_join(t1,t)
t <- gares.LngLat %>% transmute(Sor = Cde, Slng = Lng, Slat = Lat)
t1 <- inner_join(t1,t)
t1
SF <- t1 %>% mutate(OD = paste0(Entr,"-",Sor))
rm(SF)
trajetSF <- t1 %>% mutate(OD = paste0(Entr,"-",Sor))
write.table(trajetSF,"trajetSF.csv",sep=";",row.name=FALSE,quote=FALSE)
trajetSF
gares.LngLat
t <- gares.LngLat %>% transmute(Sor = Cde, Autoroute, PK)
t1 <- sens %>% filter(Entr == 0)
trajetSO <- inner_join(t,t1)
trajetSO
t
t1
t1 <- sens %>% filter(Entr == 0) %>% select(Entr, Sor)
t1
t
trajetSO <- inner_join(t,t1)
trajetSO
trajetSO <- inner_join(t,t1) %>% mutate(OD = paste0(Entr,"-",Sor))
trajetSO
write.table(trajetSO,"trajetSO.csv",sep=";",row.name=FALSE,quote=FALSE)
rm(t,t1)
trajetSF
sens
sens %>% select(Entr == 0)
sens %>% filter(Entr == 0)
t <- gares.LngLat %>% transmute(Sor = Cde, Autoroute, PK)
t1 <- sens %>% filter(Entr == 0) %>% transmute(Entr, Sor, Sens = SensSor)
trajetSO <- inner_join(t,t1) %>% mutate(OD = paste0(Entr,"-",Sor))
trajetSO
t <- gares.LngLat %>% transmute(Sor = Cde, Autoroute, PK)
t1 <- sens %>% filter(Entr == 0) %>% transmute(Entr, Sor, Sens = SensSor) %>% distinct
trajetSO <- inner_join(t,t1) %>% mutate(OD = paste0(Entr,"-",Sor))
trajetSO
trajetSO <- inner_join(t,t1) %>% mutate(OD = paste0(Entr,"-",Sor,"-",Sens))
trajetSO
write.table(trajetSO,"trajetSO.csv",sep=";",row.name=FALSE,quote=FALSE)
rm(t,t1)
library(dplyr)
library(ggplot2)
t0 <- read.table("Ref_gares_v0.csv.csv", sep = ";", header = TRUE) %>% tbl_df
t0 <- read.table("Ref_gares_v0.csv", sep = ";", header = TRUE) %>% tbl_df
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE) %>% tbl_df
t0
t1
ggplot(t0) + geom_point(aes(Lng, Lat))
ggplot(t1) + geom_point(aes(Lng, Lat))
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE) %>% tbl_df %>%
mutate(Lat = as.numeric(Lat),
Lng = as.numeric(Lng))
ggplot(t1) + geom_point(aes(Lng, Lat))
ggplot +
geom_point(data = t0, aes(Lng, Lat, col = "New")) +
geom_point(data = t1, aes(Lng, Lat, col = "Old"))
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE) %>% tbl_df %>%
mutate(Lat = as.numeric(Lat),
Lng = as.numeric(Lng))
t1
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE) %>% tbl_df %>%
mutate(Lat = as.numeric(as.character(Lat)),
Lng = as.numeric(as.character(Lng)))
t1
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE) %>% tbl_df
t1
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE, dec = ",") %>% tbl_df
t1
ggplot +
geom_point(data = t0, aes(Lng, Lat, col = "New")) +
geom_point(data = t1, aes(Lng, Lat, col = "Old"))
count(t, is.na(Lat))
count(t1, is.na(Lat))
count(t1, Ste
)
count(t1, Societe)
count(t0, Societe)
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE, dec = ",") %>% tbl_df
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE, dec = ",") %>% tbl_df
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE, dec = ",") %>% tbl_df
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE) %>% tbl_df
t2 <- read.table("Ref_gares_v2.csv", sep = ";", header = TRUE) %>% tbl_df
t2
t2 %>% tail
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE) %>% tbl_df
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE) %>% tbl_df
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE) %>% tbl_df
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE,quote = "") %>% tbl_df
rm(t2)
ggplot +
geom_point(data = t0, aes(Lng, Lat, col = "New")) +
geom_point(data = t1, aes(Lng, Lat, col = "Old"))
t1
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE,quote = "") %>% tbl_df %>%
mutate(Lat = as.numeric(Lat),
Lng = as.numeric(Lng)
)
t1
t1 <- read.table("Ref_gares_v2.csv", sep = ";", header = TRUE,quote = "") %>% tbl_df %>%
mutate(Lat = as.numeric(Lat),
Lng = as.numeric(Lng)
)
t1
ggplot +
geom_point(data = t0, aes(Lng, Lat, col = "New")) +
geom_point(data = t1, aes(Lng, Lat, col = "Old"))
ggplot +  geom_point(data = t0, aes(Lng, Lat, col = "New"))
ggplot(t0) +  geom_point( aes(Lng, Lat, col = "New"))
ggplot() +
geom_point(data = t0, aes(Lng, Lat, col = "New")) +
geom_point(data = t1, aes(Lng, Lat, col = "Old"))
ggplot() +
geom_point(data = t0, aes(Lng, Lat, col = "New")) +
geom_point(data = t1, aes(Lng, Lat, col = "Old", position = 1))
ggplot() +
geom_point(data = t0, aes(Lng, Lat, col = "New")) +
geom_point(data = t1, aes(Lng, Lat, col = "Old", position = "Test"))
ggplot() +
geom_point(data = t0, aes(Lng, Lat, col = "New")) +
geom_point(data = t1, aes(Lng, Lat, col = "Old", position=position_dodge(width=0.5)))
ggplot(position=position_dodge(width=0.5)) +
geom_point(data = t0, aes(Lng, Lat, col = "New")) +
geom_point(data = t1, aes(Lng, Lat, col = "Old"))
ggplot() +
geom_point(data = t0, aes(Lng, Lat, col = "New", alpha = .5)) +
geom_point(data = t1, aes(Lng, Lat, col = "Old", alpha = .5))
ggplot() +
geom_point(data = t0, aes(Lng, Lat, col = "New", size = 2, alpha = .1)) +
geom_point(data = t1, aes(Lng, Lat, col = "Old", alpha = .5))
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE,quote = "") %>% tbl_df %>%
mutate(Lat = as.numeric(Lat),
Lng = as.numeric(Lng)
)
ggplot() +
geom_point(data = t0, aes(Lng, Lat, col = "New", size = 2, alpha = .1)) +
geom_point(data = t1, aes(Lng, Lat, col = "Old", alpha = .5))
ggplot() +
geom_point(data = t0, aes(Lng, Lat, col = "New", size = 2, alpha = .2)) +
geom_point(data = t1, aes(Lng, Lat, col = "Old", alpha = .5))
ggplot() +
geom_point(data = t0, aes(Lng, Lat, col = "New", size = 2, alpha = .5)) +
geom_point(data = t1, aes(Lng, Lat, col = "Old", alpha = .5))
t0 <- read.table("Ref_gares_v0.csv", sep = ";", header = TRUE) %>% tbl_df
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE,quote = "") %>% tbl_df %>%
mutate(Lat = as.numeric(Lat),
Lng = as.numeric(Lng)
)
ggplot() +
geom_point(data = t0, aes(Lng, Lat, col = "New", size = 2, alpha = .5)) +
geom_point(data = t1, aes(Lng, Lat, col = "Old", alpha = .5))
library(dplyr)
library(rmarkdown)
library(ggplot2)
t0 <- read.table("Ref_gares_v0.csv", sep = ";", header = TRUE) %>% tbl_df
t1 <- read.table("Ref_gares_v1.csv", sep = ";", header = TRUE,quote = "") %>% tbl_df %>%
mutate(Lat = as.numeric(Lat),
Lng = as.numeric(Lng)
)
ggplot() +
geom_point(data = t0, aes(Lng, Lat, col = "New", size = 2, alpha = .5)) +
geom_point(data = t1, aes(Lng, Lat, col = "Old", alpha = .5))
ASF.sens
sens
ESCOTA.SF
ESCOTA
ESCOTA.temp
ESCOTA.SF <-  read.table("SF_2014.csv", header = T,  sep = ";", dec = ".") %>% tbl_df()
tSF.E <- ESCOTA.SF %>% distinct(Entr) %>% transmute(gare = Entr, Lib = Entree, ES = "E" , Cde = 25006000 + Entr)
tSF.S <- ESCOTA.SF %>% distinct(Sor) %>% transmute(gare = Sor, Lib = Sortie, ES = "S" , Cde = 25006000 + Sor)
tSF <- rbind(tSF.E, tSF.S)
# ggplot(tSF) + geom_bar(aes(gare, fill = as.factor(ES)), binwidth = 1)
tSF$Sys <- "F"
ESCOTA.SO <-  read.table("SO_2014.csv", header = T,  sep = ";", dec = ".") %>% tbl_df()
tSO <- ESCOTA.SO %>% transmute(gare = Cde, Lib, Cde = 25006000 + gare)
tSO$ES <- "O"
tSO$Sys <-"O"
tTarif <- rbind(tSF, tSO)
temp <- tTarif %>% distinct(gare) %>% select(gare, Lib, Cde, Sys)
ESCOTA.temp <- left_join(ESCOTA.temp, temp) # get Sys
# ggplot(t4) + geom_tile(aes(gare,ES, fill = ES)) + facet_wrap(~Sys, ncol = 1)
ESCOTA.temp$es <- 1
ESCOTA.temp$es[ESCOTA.temp$ES == "S"] <- 10
ESCOTA.temp <- ESCOTA.temp %>% group_by(Cde, gare, Lib, Sys) %>% summarise(es = sum(es))
ESCOTA.temp$ES <- "ES"
ESCOTA.temp$ES[ESCOTA.temp$es == 1] <- "E"
ESCOTA.temp$ES[ESCOTA.temp$es == 10] <- "S"
rm(tSF, tSF.E, tSF.S, tSO, tTarif)
temp <- gares.LngLat %>% filter(Ste == 6) %>% select(Autoroute, Cde, PK, Lng, Lat)
ESCOTA.temp <- left_join(ESCOTA.temp, temp)
ESCOTA.temp <- ESCOTA.temp %>% ungroup() %>% select(-es)
library(dplyr)
library(rmarkdown)
library(ggplot2)
library(gridExtra)
install.packages(gridExtra)
install.packages("gridExtra")
library(gridExtra)
ESCOTA.SF <-  read.table("SF_2014.csv", header = T,  sep = ";", dec = ".") %>% tbl_df()
tSF.E <- ESCOTA.SF %>% distinct(Entr) %>% transmute(gare = Entr, Lib = Entree, ES = "E" , Cde = 25006000 + Entr)
tSF.S <- ESCOTA.SF %>% distinct(Sor) %>% transmute(gare = Sor, Lib = Sortie, ES = "S" , Cde = 25006000 + Sor)
tSF <- rbind(tSF.E, tSF.S)
# ggplot(tSF) + geom_bar(aes(gare, fill = as.factor(ES)), binwidth = 1)
tSF$Sys <- "F"
ESCOTA.SO <-  read.table("SO_2014.csv", header = T,  sep = ";", dec = ".") %>% tbl_df()
tSO <- ESCOTA.SO %>% transmute(gare = Cde, Lib, Cde = 25006000 + gare)
tSO$ES <- "O"
tSO$Sys <-"O"
tTarif <- rbind(tSF, tSO)
temp <- tTarif %>% distinct(gare) %>% select(gare, Lib, Cde, Sys)
ESCOTA.temp <- left_join(ESCOTA.temp, temp) # get Sys
ESCOTA.ref <- read.table("Gares_ESCOTA_ref.csv", header = T, sep = ";") %>% tbl_df()
names(ESCOTA.ref)[2] <- "ES"
ESCOTA.ref <- ESCOTA.ref %>%
filter(ES %in% c("E", "S")) %>%
mutate(voie = as.numeric(as.character(voie))) %>%
filter(!is.na(voie))
ESCOTA.temp <- ESCOTA.ref %>% distinct(gare, ES) %>% transmute(gare, ES, Cde = 25006000 + gare)
##########
### ESCOTA - Ref sur Tarif
##########
ESCOTA.SF <-  read.table("SF_2014.csv", header = T,  sep = ";", dec = ".") %>% tbl_df()
tSF.E <- ESCOTA.SF %>% distinct(Entr) %>% transmute(gare = Entr, Lib = Entree, ES = "E" , Cde = 25006000 + Entr)
tSF.S <- ESCOTA.SF %>% distinct(Sor) %>% transmute(gare = Sor, Lib = Sortie, ES = "S" , Cde = 25006000 + Sor)
tSF <- rbind(tSF.E, tSF.S)
# ggplot(tSF) + geom_bar(aes(gare, fill = as.factor(ES)), binwidth = 1)
tSF$Sys <- "F"
ESCOTA.SO <-  read.table("SO_2014.csv", header = T,  sep = ";", dec = ".") %>% tbl_df()
tSO <- ESCOTA.SO %>% transmute(gare = Cde, Lib, Cde = 25006000 + gare)
tSO$ES <- "O"
tSO$Sys <-"O"
tTarif <- rbind(tSF, tSO)
temp <- tTarif %>% distinct(gare) %>% select(gare, Lib, Cde, Sys)
ESCOTA.temp <- left_join(ESCOTA.temp, temp) # get Sys
ESCOTA.temp
ESCOTA.SF
ESCOTA.SO
tSF
tSO
ggplot(ESCOTA,aes(Lng, Lat)) + geom_point(aes(col = as.factor(Sys)), size = 3, alpha = .5) +
geom_text(aes(label = gare), hjust=1, vjust=0)
