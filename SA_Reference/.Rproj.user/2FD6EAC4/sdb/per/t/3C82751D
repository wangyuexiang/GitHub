{
    "contents" : "---\ntitle: \"Référence - gares de péage\"\nauthor: \"WANG Yuexiang\"\ndate: \"23 septembre 2015\"\noutput: \n  html_document: \n    fig_height: 6\n    fig_width: 8\n    theme: cosmo\n    toc: yes\n---\n\n```{r, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE}\n#preparation\n\nlibrary(dplyr)\nlibrary(ggplot2)\n\n##########\n### LngLat\ngares.LngLat <- read.table(\"garesLngLat.csv\", header = T, sep = \",\") %>% tbl_df()\nnames(gares.LngLat)[1] <- \"Ste\"\n\nGetLngLat <- function(transaction) {\n  # Add longitude and lattitude to the transaction\n  # Args:\n  #\t  tansaction:\tEntr, Sor, ...\n  # Returns:\n  #\t  tansaction:\tEntr, Sor, ..., ELng, ELat, SLng, SLat\n  \n  ### !!! to be removed\n  #   transaction$Entr <- as.numeric(transaction$Entr)\n  #   transaction$Sor <- as.numeric(transaction$Sor)\n  cde <- gares.LngLat %>% transmute(Entr = Cde, ELng = Lng, ELat = Lat)\n  transaction <- left_join(transaction, cde, by = \"Entr\")\n  names(cde) <- c(\"Sor\", \"SLng\", \"SLat\")\n  transaction <- left_join(transaction, cde, by = \"Sor\")\n  return(transaction)\t\n}\n\n```\n\n## **1. Général: Tous les gares aux réseaux Vinci Autoroutes**\n(Source: tous les gares avec leur code, libellé, Autoroute, PK, Longitude, Latitude en csv)\n* ASF: 227\n* Cofiroute: 78\n* ESCOTA: 51\n\n```{r, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE}\nprint(count(gares.LngLat, Ste) %>% transmute(Societe = Ste, Nombre_des_gares = n) %>% as.data.frame())\n```\n\n```{r, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE}\nggplot(gares.LngLat) + geom_point(aes(Lng,Lat,col=as.factor(Ste))) +\n  theme(plot.title = element_text(size=20, face=\"bold\", vjust=2),\n        legend.position = \"right\",\n        legend.title = element_blank()) +\n  ggtitle(\"Figure 1.1 Tous les gares\")\n```\n\n## **2. Gares dans ESCOTA**\n### **2.1 Système F/O et Autoroute**\n(Source: tous les trajets possibles avec le tarif correspondant en csv )\n\n* Système Fermé(25): Entrée et Sortie\n* Système Ouvert(23)\n\n\n```{r, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE}\n### référence avec les voies\ng4 <- read.table(\"Gares_ESCOTA_ref.csv\", header = T, sep = \";\") %>% tbl_df()\nnames(g4)[2] <- \"ES\"\ng4 <- g4 %>% filter(ES %in% c(\"E\", \"S\"))\n\nt4 <- g4 %>% distinct(gare, ES) %>% transmute(gare, ES, Cde = 25006000 + gare)\n\n### identifier le système du gare\nSF <-  read.table(\"SF_2014.csv\", header = T,  sep = \";\", dec = \".\") %>% tbl_df()\ntSF.E <- SF %>% distinct(Entr) %>% transmute(gare = Entr, Lib = Entree, ES = \"E\" , Cde = 25006000 + Entr) \ntSF.S <- SF %>% distinct(Sor) %>% transmute(gare = Sor, Lib = Sortie, ES = \"S\" , Cde = 25006000 + Sor) \ntSF <- rbind(tSF.E, tSF.S)\n# ggplot(tSF) + geom_bar(aes(gare, fill = as.factor(ES)), binwidth = 1)\ntSF$Sys <- \"F\"\n\nSO <-  read.table(\"SO_2014.csv\", header = T,  sep = \";\", dec = \".\") %>% tbl_df()\ntSO <- SO %>% transmute(gare = Cde, Lib, Cde = 25006000 + gare)\ntSO$ES <- \"O\"\ntSO$Sys <-\"O\"\n\ntTarif <- rbind(tSF, tSO)\ntemp <- tTarif %>% distinct(gare) %>% select(gare, Lib, Cde, Sys)\nt4 <- left_join(t4, temp) # get Sys\n\n# ggplot(t4) + geom_tile(aes(gare,ES, fill = ES)) + facet_wrap(~Sys, ncol = 1)\n\nt4$es <- 1\nt4$es[t4$ES == \"S\"] <- 10\nt4 <- t4 %>% group_by(Cde, gare, Lib, Sys) %>% summarise(es = sum(es))\n\nt4$ES <- \"ES\"\nt4$ES[t4$es == 1] <- \"E\"\nt4$ES[t4$es == 10] <- \"S\"\n\nrm(tSF, tSF.E, tSF.S, tSO, tTarif)\n\ntemp <- gares.LngLat %>% filter(Ste == 6) %>% select(Autoroute, Cde, PK, Lng, Lat) \nt4 <- left_join(t4, temp)\n```\n\n```{r, echo=FALSE, cache=TRUE, fig.width=12}\nlibrary(gridExtra)\ng1 <- ggplot(t4) + geom_point(aes(Lng,Lat,col=as.factor(Sys))) +\n  theme(plot.title = element_text(size=20, face=\"bold\", vjust=2),\n        legend.position = \"right\",\n        legend.title = element_blank()) +\n  ggtitle(\"Figure 2.1 Système Fermé(F) ou Ouvert(O)\")\ng2 <- ggplot(t4) + geom_point(aes(Lng,Lat,col=as.factor(Autoroute))) +\n  theme(plot.title = element_text(size=20, face=\"bold\", vjust=2),\n        legend.position = \"right\",\n        legend.title = element_blank()) +\n  ggtitle(\"Figure 2.2 Autoroute\")\ngrid.arrange(g1,g2,ncol = 2)\n```\n\n### **2.2 Gares spéciaux**\n* 3 Gares dans le système ouvert n'ont qu'un sens:\n    * Entrée, seulement(2): Cagnes Ouest Sud(17), Sophia(24)\n    * Sortie, seulement(1): Cagnes Ouest Nord(15)\n* 3 Gares Virtuels (existent dans le référence mais pas dans la liste de tarif)\n    * La Barque Entree(80)\n    * Antibes PV Nord(22)\n    * Antibes Est Sortie(23)\n    \n```{r, echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.width=12}\nt4 <- t4 %>% ungroup() %>% select(-es)\n\ntemp <- gares.LngLat %>% filter(Ste == 6) %>% mutate(Virtuel = FALSE)\ntemp1 <- t4 %>% ungroup() %>% select(Cde)\ntemp2 <- anti_join(temp,temp1) \ntemp$in.Tarif[temp$Cde %in% temp2$Cde] <- TRUE\n\nprint( temp2 %>% select(Lib, Autoroute, Cde, PK) %>% as.data.frame)\n\ng1 <- ggplot(t4) + geom_point(aes(Lng,Lat,col=as.factor(ES))) +\n  theme(plot.title = element_text(size=20, face=\"bold\", vjust=2),\n        legend.position = \"right\") +\n  ggtitle(\"Figure 2.3 Entrée ou Sortie seulement\")\n\ng2 <- ggplot(temp) + geom_point(aes(Lng,Lat,col=as.factor(in.Tarif))) +\n  theme(plot.title = element_text(size=20, face=\"bold\", vjust=2),\n        legend.position = \"right\") +\n  ggtitle(\"Figure 2.4 Gares virtuels\")\n\ngrid.arrange(g1,g2,ncol=2)\n```\n\n### **2.3 Ajouter Sens pour les trajets**\n\n\n",
    "created" : 1443017507634.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "0|3|8|16|\n12|60|40|3|\n52|60|58|3|\n68|60|107|3|\n",
    "hash" : "820211982",
    "id" : "3C82751D",
    "lastKnownWriteTime" : 1443189654,
    "path" : "~/SVN/Reference/Ref_gares.Rmd",
    "project_path" : "Ref_gares.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_markdown"
}