{
    "contents" : "library(ggplot2)\nlibrary(gridExtra)\n\n###########\n### 20151023\n\ntemp.result <- result.final\ntemp.result$HP <- NA # heure pointe\ntemp.result$HP[temp.result$Tmin >= 6 & temp.result$Tmax <= 10] <- \"10-Matin\"\ntemp.result$HP[temp.result$Tmin >= 10 & temp.result$Tmax <= 14] <- \"14-Midi\"\ntemp.result$HP[temp.result$Tmin >= 14 & temp.result$Tmax <= 16] <- \"16-Aprem\"\ntemp.result$HP[temp.result$Tmin >= 16 & temp.result$Tmax <= 20] <- \"20-Soir\"\ntemp.result$HP[temp.result$Tmin >= 20] <- \"24-Nuit\"\n\ntemp.result <- temp.result %>% mutate(TDiff = Tmax - Tmin)\ntemp.result$Diff <- NA # Tmax - Tmin\ntemp.result$Diff[temp.result$TDiff <= 1] <- \"1 SuperRegular\"\ntemp.result$Diff[temp.result$TDiff > 1 & temp.result$TDiff <= 2] <- \"2 Regular\"\ntemp.result$Diff[temp.result$TDiff > 2 & temp.result$TDiff <= 4] <- \"4 So-So\"\ntemp.result$Diff[temp.result$TDiff > 4] <- \"6 Nul\"\n\n\ntemp.result$WE[temp.result$WE == TRUE] <- \"Weekend\"\ntemp.result$WE[temp.result$WE == FALSE] <- \"Weedday\"\n\n\n\n\nggplot(temp.result) + geom_point(aes(Tmin,Tmax, col = as.factor(Diff)))+\n  geom_abline(slope = 1, intercept = 2) +\n  geom_abline(slope = 1, intercept = 4) +\n  geom_abline(slope = 1, intercept = 6) \n\ng1 <- ggplot(temp.result) + \n  geom_density(aes(Tmax, col = \"Tmax\")) +\n  geom_density(aes(Tmin, col = \"Tmin\")) + facet_wrap(~WE)\n\ng2 <- ggplot(temp.result) + geom_point(aes(Tmin,Tmax, col = as.factor(HP)))+  geom_abline(slope = 1, intercept = 2, size = 1.5)\ngrid.arrange(g1,g2)\n\n\ng4 <- ggplot(temp.result) + geom_point(aes(Tmin,Tmax - Tmin, col = as.factor(HP))) + ylab(\"Time Difference\")\ng3 <- ggplot(temp.result) + geom_point(aes(Tmin,Tmax, col = as.factor(HP)))+\n  geom_abline(slope = 1, intercept = 2) +\n  geom_abline(slope = 1, intercept = 4) +\n  geom_abline(slope = 1, intercept = 6) +\n  facet_wrap(~WE)\ngrid.arrange(g1, g3, main = \"Distribution of Tmin & Tmax\")\n# peak at HP matin & soir\n# weird peak around afternoon\n\nggplot(temp.result) + \n  geom_density(aes(Tmax, col = \"Tmax\")) +\n  geom_density(aes(Tmin, col = \"Tmin\")) + facet_wrap(~WE)\n\n\nggplot(temp.result) + geom_density(aes(Tmax - Tmin)) + xlab(\"Time Difference\")\nggplot(temp.result) + geom_bar(aes(Tmax - Tmin), binwidth = 2) + xlab(\"Time Difference\")\n\ntemp.result$DOW[temp.result$DOW==0] <- 7\ntemp.result <- temp.result %>% mutate(WE = (DOW>5))\n\n\n# during the week: centered in the HP matin & soir |,trajet more frequent \n# during the weekend, more disperse\ng6 <- ggplot(temp.result) + geom_point(aes(Tmin,Tmax, col = as.factor(WE), alpha = .2)) + facet_wrap(~WE)\ng7 <- ggplot(temp.result) + geom_point(aes(Tmin,Tmax, col = as.factor(WE), size = noPsg, alpha = .2)) + facet_wrap(~WE)\ngrid.arrange(g6, g7, main = \"weekday vs. weekend\")\n###\nggplot(temp.result) + geom_point(aes(Tmin,Tmax, col = as.factor(Diff))) + facet_grid(Diff~WE)\n\ng8 <- ggplot(temp.result) + geom_point(aes(Tmin,Tmax, col = as.factor(Diff), alpha = .2)) + facet_wrap(~WE) + ggtitle(\"Régularité des trajets\")\n\ngrid.arrange(g8, g7, main = \"weekday vs. weekend\")\n\nggplot(temp.result) + geom_point(aes(Tmin,Tmax, col = as.factor(Diff)))\ncount(temp.result, Diff, HP)\n\n\n\n###########\n### 20151022\ntemp.result <- count(result.final,ID, OD)\ntemp.result <- temp.result %>% rename(WeekPattern = n)\n\nt <- count(result.final,ID,OD, Tmax <12)\nt <- t %>% rename(WeekPattern = n)\nt1 <- t %>% group_by(ID,OD) %>% summarise(AMPM = n())\n\n# find taxi driver\n\ntemp <- transaction2\n\ntemp.ID <- temp %>%\n  group_by(ID) %>%\n  summarise(n = n()) %>%\n  arrange(desc(n))\n\ntemp.E <- temp %>%\n  group_by(ID, Entr) %>% \n  summarise(noE = n()) %>%\n  filter(Entr != 0)\n\ntemp.E <- temp.E %>%\n  ungroup() %>%\n  group_by(ID) %>%\n  arrange(desc(noE)) %>%\n  mutate(ord = row_number())\n\ntemp.S <- transaction2 %>%\n  group_by(ID, Sor) %>% \n  summarise(noS = n()\n  ) \n\ntemp.S <- temp.S %>%\n  ungroup() %>%\n  group_by(ID) %>%\n  arrange(desc(noS)) %>%\n  mutate(ord = row_number())\n\nnames(temp.E) <- c(\"ID\",\"Gare\",\"noE\",\"ordE\")\ntemp.E <- inner_join(temp.E, temp.ID)\ntemp.E <- temp.E %>% mutate(perE = noE/n)\n\nnames(temp.S) <- c(\"ID\",\"Gare\",\"noS\",\"ordS\")\ntemp.S <- inner_join(temp.S, temp.ID)\ntemp.S <- temp.S %>% mutate(perS = noS/n)\n\ntemp.Gare <- full_join(temp.E,temp.S)\n\n\n# analyse no of Entr\ntemp.noGE <- temp.E %>%\n  group_by(ID) %>%\n  arrange(ordE) %>%\n  summarise(noGE = n(),\n            maxPerE = max(perE),\n            secPerE = nth(perE, 2),\n            thrPerE = nth(perE, 3)\n            )\n\ntemp.noGS <- temp.S %>%\n  group_by(ID) %>%\n  arrange(ordS) %>%\n  summarise(noGS = n(),\n            maxPerS = max(perS),\n            secPerS = nth(perS, 2),\n            thrPerS = nth(perS, 3)\n  )\n\n\ntemp.noGare <- full_join(temp.noGE,temp.noGS)\n\n\nggplot(temp.noGare) + \n  geom_point(aes(maxPerS,secPerS, col = \"Sor\", alpha = .2)) +\n  geom_point(aes(maxPerE,secPerE, col = \"Entr\", alpha = .2)) +\n#   geom_segment(aes(x= maxPerE, y = secPerE,\n#                    xend=maxPerS, yend = secPerS)) +\n  scale_y_continuous(limits = c(0,1))\n\nggplot(temp.noGare) + geom_point(aes(maxPerS,secPerS, size = noGS))\n\nggplot(temp.noGare) + \n  geom_segment(aes(x= maxPerE, y = secPerE + maxPerE,\n                   xend=maxPerS, yend = secPerS + maxPerS, alpha = .1)) +\n  geom_point(aes(maxPerS, secPerS + maxPerS, col = \"Sor\", alpha = .2 )) +\n  geom_point(aes(maxPerE, secPerE + maxPerE, col = \"Entr\", alpha = .2 )) \n\n\n\nggplot(temp.noGare) + geom_point(aes(maxPerS, secPerS + maxPerS))\nggplot(temp.noGare) + geom_point(aes(maxPerS, secPerS + maxPerS, size = noGS))\n\nggplot(temp.noGare) + geom_bar(aes( maxPerS))\nggplot(temp.noGare) + geom_bar(aes(secPerS + maxPerS))\n\n\ntemp.result <- count(result.final, ID) %>%\n  transmute(ID, result = (n>=1))\n\nt <- full_join(temp.result, temp.noGare)\nt$result <- !is.na(t$result)\nggplot(t) + geom_point(aes(maxPerS, secPerS + maxPerS, col = as.factor(result), alpha = .2))\n\n\nggplot(temp.Gare) + geom_point(aes(ordE,ordS))\nggplot(temp.Gare) + geom_point(aes(noE,noS))\n\n\n\n\nt1 <- temp.noGare %>% filter(maxPerS == secPerS) %>%\n  select(ID, maxPerS)\nt1.1 <- left_join(t1 %>% rename(perS = maxPerS), temp.Gare)\n\n\n### useful graph\n\nggplot(temp.noGare) + geom_point(aes(maxPerS,maxPerS + secPerS))\n\n\nggplot(temp.noGare) + \n  geom_density(aes(maxPerS, col = \"1\")) +\n  geom_density(aes(maxPerS + secPerS, col = \"1+2\")) +\n  geom_density(aes(maxPerS + secPerS + thrPerS, col = \"1+2+3\")) +\n  xlab(\"Per\")\n",
    "created" : 1445355503396.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2978271254",
    "id" : "7D3BB4BA",
    "lastKnownWriteTime" : 1445872158,
    "path" : "~/SVN/App_4250/App_4250_find_taxi_driver.R",
    "project_path" : "App_4250_find_taxi_driver.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_source"
}